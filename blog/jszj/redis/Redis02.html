<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>Redis的持久化机制及其持久化策略 | 不会说话的刘同学</title><meta name="description" content="">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.2a20173f.css" as="style" /><link rel="stylesheet" href="/assets/style.2a20173f.css" />
    <link rel="modulepreload" href="/assets/app.35bbfe3f.js"><link rel="modulepreload" href="/assets/framework.3bd681ae.js"><link rel="modulepreload" href="/assets/Redis02.html.e68acc4e.js"><link rel="modulepreload" href="/assets/Redis02.html.01ce2589.js"><link rel="prefetch" href="/assets/index.html.6302c952.js" as="script" /><link rel="prefetch" href="/assets/slides.html.769cd08f.js" as="script" /><link rel="prefetch" href="/assets/disable.html.490b54c9.js" as="script" /><link rel="prefetch" href="/assets/encrypt.html.de5ee159.js" as="script" /><link rel="prefetch" href="/assets/markdown.html.1471d76f.js" as="script" /><link rel="prefetch" href="/assets/page.html.00e85374.js" as="script" /><link rel="prefetch" href="/assets/index.html.6f3e5a3f.js" as="script" /><link rel="prefetch" href="/assets/index.html.263d2fb8.js" as="script" /><link rel="prefetch" href="/assets/index.html.d8e60229.js" as="script" /><link rel="prefetch" href="/assets/slides.html.4cdda82b.js" as="script" /><link rel="prefetch" href="/assets/index.html.31f3f08b.js" as="script" /><link rel="prefetch" href="/assets/index.html.c8622ca2.js" as="script" /><link rel="prefetch" href="/assets/index.html.86748799.js" as="script" /><link rel="prefetch" href="/assets/baz.html.5c7451df.js" as="script" /><link rel="prefetch" href="/assets/index.html.02c24faf.js" as="script" /><link rel="prefetch" href="/assets/ray.html.1203ed64.js" as="script" /><link rel="prefetch" href="/assets/index.html.c5d409c3.js" as="script" /><link rel="prefetch" href="/assets/disable.html.67b6b72d.js" as="script" /><link rel="prefetch" href="/assets/encrypt.html.14fba031.js" as="script" /><link rel="prefetch" href="/assets/markdown.html.0ceb0572.js" as="script" /><link rel="prefetch" href="/assets/page.html.2bb5957b.js" as="script" /><link rel="prefetch" href="/assets/index.html.5da7f899.js" as="script" /><link rel="prefetch" href="/assets/index.html.52d7fb2c.js" as="script" /><link rel="prefetch" href="/assets/HashMap.html.19899616.js" as="script" /><link rel="prefetch" href="/assets/dubbo01.html.bbc46f5b.js" as="script" /><link rel="prefetch" href="/assets/javaio01.html.af77d623.js" as="script" /><link rel="prefetch" href="/assets/javaio02.html.1b65a673.js" as="script" /><link rel="prefetch" href="/assets/Thread01.html.f28c9834.js" as="script" /><link rel="prefetch" href="/assets/Redis03.html.7dae2903.js" as="script" /><link rel="prefetch" href="/assets/Redis04.html.5463d105.js" as="script" /><link rel="prefetch" href="/assets/Spring01.html.70cb02de.js" as="script" /><link rel="prefetch" href="/assets/spring_01.html.cda93c86.js" as="script" /><link rel="prefetch" href="/assets/index.html.443b7d4d.js" as="script" /><link rel="prefetch" href="/assets/index.html.b46b5995.js" as="script" /><link rel="prefetch" href="/assets/index.html.ac4baaf9.js" as="script" /><link rel="prefetch" href="/assets/baz.html.fb0944a3.js" as="script" /><link rel="prefetch" href="/assets/index.html.1ce677c5.js" as="script" /><link rel="prefetch" href="/assets/ray.html.a251e01e.js" as="script" /><link rel="prefetch" href="/assets/index.html.120c630c.js" as="script" /><link rel="prefetch" href="/assets/redis_01.html.af4cd3ce.js" as="script" /><link rel="prefetch" href="/assets/spring_01.html.2bbcb8ab.js" as="script" /><link rel="prefetch" href="/assets/404.html.da9ed260.js" as="script" /><link rel="prefetch" href="/assets/index.html.862bceef.js" as="script" /><link rel="prefetch" href="/assets/slides.html.46e59222.js" as="script" /><link rel="prefetch" href="/assets/disable.html.a2f24051.js" as="script" /><link rel="prefetch" href="/assets/encrypt.html.9e34418b.js" as="script" /><link rel="prefetch" href="/assets/markdown.html.da6de833.js" as="script" /><link rel="prefetch" href="/assets/page.html.4879c622.js" as="script" /><link rel="prefetch" href="/assets/index.html.1a49309e.js" as="script" /><link rel="prefetch" href="/assets/index.html.6e5a7f5f.js" as="script" /><link rel="prefetch" href="/assets/index.html.ee30200e.js" as="script" /><link rel="prefetch" href="/assets/slides.html.7e73a934.js" as="script" /><link rel="prefetch" href="/assets/index.html.ed3bf23e.js" as="script" /><link rel="prefetch" href="/assets/index.html.da7151af.js" as="script" /><link rel="prefetch" href="/assets/index.html.9b27611e.js" as="script" /><link rel="prefetch" href="/assets/baz.html.0d459fe8.js" as="script" /><link rel="prefetch" href="/assets/index.html.ac92337a.js" as="script" /><link rel="prefetch" href="/assets/ray.html.ddb77a54.js" as="script" /><link rel="prefetch" href="/assets/index.html.c6a3cba9.js" as="script" /><link rel="prefetch" href="/assets/disable.html.b8cea077.js" as="script" /><link rel="prefetch" href="/assets/encrypt.html.147d5b28.js" as="script" /><link rel="prefetch" href="/assets/markdown.html.f2659120.js" as="script" /><link rel="prefetch" href="/assets/page.html.b19adaaf.js" as="script" /><link rel="prefetch" href="/assets/index.html.81890044.js" as="script" /><link rel="prefetch" href="/assets/index.html.c6b39350.js" as="script" /><link rel="prefetch" href="/assets/HashMap.html.c0577445.js" as="script" /><link rel="prefetch" href="/assets/dubbo01.html.5e39b4d8.js" as="script" /><link rel="prefetch" href="/assets/javaio01.html.51b6a59f.js" as="script" /><link rel="prefetch" href="/assets/javaio02.html.0ab43469.js" as="script" /><link rel="prefetch" href="/assets/Thread01.html.8fd99f04.js" as="script" /><link rel="prefetch" href="/assets/Redis03.html.309e9054.js" as="script" /><link rel="prefetch" href="/assets/Redis04.html.c6272091.js" as="script" /><link rel="prefetch" href="/assets/Spring01.html.48e26027.js" as="script" /><link rel="prefetch" href="/assets/spring_01.html.bb9193bd.js" as="script" /><link rel="prefetch" href="/assets/index.html.83ea3c15.js" as="script" /><link rel="prefetch" href="/assets/index.html.616f1611.js" as="script" /><link rel="prefetch" href="/assets/index.html.4239acbb.js" as="script" /><link rel="prefetch" href="/assets/baz.html.b483d0dd.js" as="script" /><link rel="prefetch" href="/assets/index.html.206afcce.js" as="script" /><link rel="prefetch" href="/assets/ray.html.6be27ed1.js" as="script" /><link rel="prefetch" href="/assets/index.html.03d5605d.js" as="script" /><link rel="prefetch" href="/assets/redis_01.html.75bdf6f2.js" as="script" /><link rel="prefetch" href="/assets/spring_01.html.e595012a.js" as="script" /><link rel="prefetch" href="/assets/404.html.cc54d8af.js" as="script" /><link rel="prefetch" href="/assets/photoswipe.esm.720e8656.js" as="script" />
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/icon.png" alt="不会说话的刘同学"><!----><span class="site-name hide-in-pad">不会说话的刘同学</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/blog/jszj/" class="nav-link active" aria-label="技术总结"><span class="icon java"></span>技术总结<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/ymxl/" class="nav-link" aria-label="源码系列"><span class="icon java"></span>源码系列<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/msfx/" class="nav-link" aria-label="面试复习"><span class="icon java"></span>面试复习<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/JavaLiuTongXue/JavaCoding" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">Java IO</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">集合框架</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">多线程</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">线程池</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">JVM</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">JDK并发工具</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">Spring</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">Mysql</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon creative"></span><span class="title">Redis</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/blog/jszj/redis/Redis02.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Redis的持久化机制及其持久化策略"><!---->Redis的持久化机制及其持久化策略<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#rdb持久化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="RDB持久化"><!---->RDB持久化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#持久化策略" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="持久化策略"><!---->持久化策略<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#aof持久化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="AOF持久化"><!---->AOF持久化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#持久化策略-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="持久化策略"><!---->持久化策略<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#重写机制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="重写机制"><!---->重写机制<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#rdb持久化与aof持久化的优缺点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="RDB持久化与AOF持久化的优缺点"><!---->RDB持久化与AOF持久化的优缺点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#混合持久化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="混合持久化"><!---->混合持久化<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/blog/jszj/redis/Redis03.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis集群架构所产生的问题及如何处理"><!---->Redis集群架构所产生的问题及如何处理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/blog/jszj/redis/Redis04.html" class="nav-link sidebar-link sidebar-page" aria-label="Redis对于过期key的处理"><!---->Redis对于过期key的处理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">分布式框架</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">消息队列</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">微服务</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">分布式事务</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon creative"></span><span class="title">分库分表解决方案</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Redis的持久化机制及其持久化策略</h1><div class="page-info"><!----><!----><!----><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 9 分钟</span><meta property="timeRequired" content="PT9M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#rdb持久化" class="router-link-active router-link-exact-active toc-link level2">RDB持久化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#持久化策略" class="router-link-active router-link-exact-active toc-link level3">持久化策略</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#aof持久化" class="router-link-active router-link-exact-active toc-link level2">AOF持久化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#持久化策略-1" class="router-link-active router-link-exact-active toc-link level3">持久化策略</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#重写机制" class="router-link-active router-link-exact-active toc-link level3">重写机制</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#rdb持久化与aof持久化的优缺点" class="router-link-active router-link-exact-active toc-link level2">RDB持久化与AOF持久化的优缺点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/jszj/redis/Redis02.html#混合持久化" class="router-link-active router-link-exact-active toc-link level2">混合持久化</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="redis的持久化机制及其持久化策略" tabindex="-1"><a class="header-anchor" href="#redis的持久化机制及其持久化策略" aria-hidden="true">#</a> Redis的持久化机制及其持久化策略</h1><p>Redis 虽然是一个内存数据库，但是为了保证在宕机的时候能够让数据迅速的恢复到最初的状态，Redis 提供了三种持久化机制---RDB 、AOF、混合持久化</p><p>本篇文章就来具体讲讲这几种持久化机制及其对应的持久化策略</p><h2 id="rdb持久化" tabindex="-1"><a class="header-anchor" href="#rdb持久化" aria-hidden="true">#</a> RDB持久化</h2><p>RDB 持久化指的是 Redis 会在某一时刻触发并将内存中所有的数据以二进制的方式保存在一个 dump.rdb 文件里，这也是 Redis 默认的持久化方式</p><p>RDB 持久化是需要条件触发的，我们如果要开启 RDB 持久化只需要在 conf 文件中配置一个 save 参数，这个参数也就代表了触发RDB持久化的条件，如下：</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8de6b1b8d4404caea315815604d7b185~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>我们可以具体看下这个配置参数:</p><blockquote><p><strong>save &lt;seconds&gt; &lt;changes&gt;</strong></p></blockquote><p>seconds 代表多少秒内，changes 代表执行了多少条修改命令</p><p>如果我配置成了 save 60 10000 ，那就是代表如果在 60s 内执行了 10000 条修改命令，就会触发RDB持久化，如下：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f688ca6f887b49b2946ffe18ebb07e37~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>这里要注意一下，这里执行 10000 条命令指的是修改数据命令，查询的命令不包括在内</p><p>生成的 dump.rdb 文件会放在 redis 的根目录下，如果要修改 rdb 文件存放的路径的话可以通过 dir 参数修改，比如想要放在其他目录里，那么可以这样改：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8010ab35107e41bea9e03d39d6ae78c6~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>rdb 文件默认的名称是 dump ，如果想要修改的话可以通过 dbfilename 参数修改，如下：</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/466d2c375ef3495d852f2071563e83f2~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>以上是通过配置触发条件自动触发 RDB持久化，Redis 还给我们提供了手动触发的方式，我们只通过客户端执行 save 命令就行了，如下：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d6b28839bdc4296872b878f977b0e5f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>除了 save 命令外，Redis 还提供了一个 bgsave 的命令，它与 save 命令区别如下：</p><p>1、由于 Redis 是单线程的，因此 save 命令在做持久化的时候时候会阻塞其他命令的执行，属于同步执行</p><p>2、bgsave 则会从主线程中另外 fork 出一个子线程进行持久化操作，从而不会阻塞其他命令的执行，属于异步执行</p><p>上面讲的自动触发持久化也是通过 bgsave 的方式来进行的</p><p>我们可以具体来看看 rdb 文件里的内容：</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8ef85aa2c654fe1a922165b8054b4f0~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>由于是使用二进制进行存储的，所以基本上也看不懂</p><p>RDB持久化是通过把内存数据以二进制的方式保存到rdb文件中，在宕机恢复的时候就可以直接一次性加载</p><h3 id="持久化策略" tabindex="-1"><a class="header-anchor" href="#持久化策略" aria-hidden="true">#</a> 持久化策略</h3><p>就像我刚配置的在 60s 内执行 10000 条命令就触发是持久化策略的一种</p><p>这里其实Redis也默认的提供了三种不同的持久化策略，如下</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d92d896c4c0c42dcbfd22d3668a09ae9~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>我们平时就使用这种默认的持久化就可以了，如果这三种默认持久化不能满满足需求的话，可以按照自己的需要去配置</p><p>但是在配置的时候我们应当尽可能基于使用场景及性能方面来进行考虑</p><h2 id="aof持久化" tabindex="-1"><a class="header-anchor" href="#aof持久化" aria-hidden="true">#</a> AOF持久化</h2><p>AOF持久化就是Redis在持久化数据的时候会把修改数据的命令通过追加的方式保存到 aof 文件中，在宕机恢复的时候通过执行 aof 文件中的命令来恢复数据</p><p>我们如果要开启 aof 持久化机制可以把 conf 文件中的 appendonly 参数配置成 yes 来开启，如下：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/30c84d0e8b97420c8731e8577086919b~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>aof 文件名称默认是 appendonly ，如果要修改的话可以通过 appendfilename 来修改，机制跟 RDB 差不多</p><p>我们可以具体来看下 aof 文件里的内容：</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3951ac6dd4049389addd6360a171f2e~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>相比于 rdb 来讲，aof 里的内容可能会比较直观点，这里要注意一下，aof 文件里的命令存储结构并不是像我们在Redis客户端执行的命令结构那样去存储，而是通过一种特殊的结构进行存储，具体执行的命令我在图上框起来了，大家可以自己研究下</p><p>由于 aof 文件中保存的是执行修改的命令，而 RDB 是以二进制方式保存的，因此在空间占用上会比 RDB 要大点</p><h3 id="持久化策略-1" tabindex="-1"><a class="header-anchor" href="#持久化策略-1" aria-hidden="true">#</a> 持久化策略</h3><p>AOF也提供了三种持久化策略，在 conf 文件中如下：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4af8fdf63c01499e83907cc6f9ceb15a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>我们来具体看下这三种策略：</p><p><strong>appendfsync always:</strong> 每次有新命令追加到 AOF 文件时就执行一次 fsync，数据持久化非常慢，也非常安全</p><p><strong>appendfsync everysec:</strong> 每秒 fsync 一次，足够快，并且在故障时也只会丢失 1 秒钟的数据，这个是redis默认的持久化策略</p><p><strong>appendfsync no:</strong> 从不 fsync ，将数据交给操作系统来处理。更快，也更不安全的选择</p><p>如果在持久化的时候要想要在持久化的速度和数据安全之间来权衡的话，可以选择第二种</p><h3 id="重写机制" tabindex="-1"><a class="header-anchor" href="#重写机制" aria-hidden="true">#</a> 重写机制</h3><p>重写机制其实是 Redis 对AOF持久化机制做的一个优化，由于AOF是通过追加命令的方式来持久化的，这样会造成两个问题：</p><p>1、通过命令追加的方式来持久化，这就会造成aof文件非常大，空间占用非常大</p><p>2、在宕机恢复数据的时候会执行aof文件里所有的命令，如果aof文件里的命令非常多，也会造成一定的性能消耗</p><p>此时AOF重写机制就发挥了很大的作用了，它会把 aof 文件里的一些重复的命令整合成一条命令，这样极大的缩小了aof文件的，避免占用更多的空间，也避免了一定程度的性能消耗</p><p>为了能够更好的理解这个重写机制，我来举一个例子：</p><p>我现在往 Redis 执行了五条命令 ，如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>set name zhangsan1
set name zhangsan2
set name zhangsan3
set name zhangsan4
set name zhangsan5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 aof 未重写之前，会把这五条命令全部追加到 aof 文件中，在重写之后会把前面的没有用的四条命令去掉，只保留最后一条，也就是我们说的把 <strong>重复的命令整合成一条命令</strong></p><p>这里我还是要解释下的，为啥会只保留最后一条执行命令呢</p><p>这是因为上面这些重复命令对于 name 对应的值的影响，只看这最后一条命令</p><p>我们也可以在配置文件里配置AOF重写机制的，只需要配置下 auto‐aof‐rewrite‐min‐size 和 auto‐aof‐rewrite‐percentage 这两个参数就行了，对应的 conf 文件如下：</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92db0b6410f44b73a84d1aa2889147d7~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p><strong>auto-aof-rewrite-min-size：</strong> 代表aof文件至少要达到多大才会自动重写，，比如我配置的是 64mb ，那么当文件达到 64mb 的时候才会重写，文件太小恢复速度本来就很快，如果这个参数设置的太小，那么重写的意义不大</p><p><strong>auto‐aof‐rewrite‐percentage：</strong> 代表aof文件自上一次重写后文件大小增长了多少则再次触发重写，比如这里我配置的是 100 ，那么就表示aof文件自上一次重写后文件大小增长了 100% 再次触发重写</p><p>AOF 去重同样也可以通过手动的方式来去重，我们只需要在客户端执行 bgrewriteaof 命令就行了</p><h2 id="rdb持久化与aof持久化的优缺点" tabindex="-1"><a class="header-anchor" href="#rdb持久化与aof持久化的优缺点" aria-hidden="true">#</a> RDB持久化与AOF持久化的优缺点</h2><p>这两种机制使用不同的方式进行持久化，因此也有很明显的优缺点，如下：</p><p>1、RDB持久化是把内存中的数据通过二进制的方式保存到 rdb 文件里，因此 rdb 文件占用的空间会比较小，在数据恢复的时候直接加载 rdb 文件即可，因此 RDB 持久化在恢复数据的时候比较快；而 AOF 持久化只直接通过命令追加的方式把命令保存到 aof 文件中，因此 aof 文件占用的空间比较大，在恢复数据的时候需要一条一条的执行 aof 文件中的命令，因此数据恢复比较慢</p><p>2、RDB提供的持久化策略是在多少秒内执行多少次修改命令才对内存中的数据进行持久化，因此它在宕机的时候最容易丢失数据，数据安全性很低，比如我配置的 60s ，那么如果在 60s 内宕机了，那么就直接丢失了 60s 内的数据；AOF的数据安全性是根据AOF持久化策略来的，相对于RDB来讲，AOF持久化的不易丢失数据，安全性更高点</p><p>3、AOF拥有更高的数据安全性，如果同时配置了AOF和RDB，那么在恢复数据的时候会优先通过AOF来恢复数据</p><h2 id="混合持久化" tabindex="-1"><a class="header-anchor" href="#混合持久化" aria-hidden="true">#</a> 混合持久化</h2><p>除了上面的两种持久化机制之外，Redis还提供了一种将RDB和AOF结合的方式来进行持久化，这种混合持久化结合了RDB和AOF各自的优点，既能做到恢复速度快又能保证数据的安全性</p><p>我们如果开启混合持久化的机制的话，只需要在 conf 文件里把 aof‐use‐rdb‐preamble 参数设置成 yes，如下：</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/146ce9cc470d4e70874678db15d571bb~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>但是这里需要注意，如果要开启混合持久机制的话则必须要先开启AOF持久化机制</p><p>在开启混合持久化机制之后，AOF在重写的时候会将内存中重写那一刻的数据以二进制的形式保存在一个新的AOF文件中，如果在重写的过程中有新的命令过来了，会把命令追加到新的aof文件最后，重写完成之后会把原有的aof文件覆盖掉</p><p>在开启完混合持久化机制之后，我们可以来看看aof文件里的内容：</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de4e8f7085e34e05ba7050218b915ad7~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>图片中上面红色的框框就是二进制数据，下面红色的框框是追加的命令</p></div><!----><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><!----><a href="/blog/jszj/redis/Redis03.html" class="nav-link next" aria-label="Redis集群架构所产生的问题及如何处理"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Redis集群架构所产生的问题及如何处理<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.35bbfe3f.js" defer></script>
  </body>
</html>
